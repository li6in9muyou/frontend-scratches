<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Scratch</title>
  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      background-color: #888;
    }

    li {
      list-style: none;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .box {
      width: 150px;
      height: 100px;
      background-color: limegreen;
      border-radius: 8px;
      cursor: move;
      transition-property: transform;
      transition-duration: 200ms;
      font-size: 64px;
      line-height: 100px;
      text-align: center;
    }

    .box__lifted {
      transform: scale(1.05);
      box-shadow: 3px 3px 6px #222;
      z-index: 100;
    }

    .box-wrap {
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      width: calc(150px * 3 + 20px * 2);
    }
  </style>
  <script>
    function listenEvent(elem, event, callback, ...args) {
      var unlisten;
      if (elem.addEventListener) {
        elem.addEventListener(event, callback, ...args);
        unlisten = function () {
          elem.removeEventListener(event, callback);
        };
      } else {
        // IE 9
        elem.attachEvent("on" + event);
        unlisten = function () {
          elem.detachEvent("on" + event, callback);
        };
      }
      return unlisten;
    }
  </script>
</head>

<body>
  <ul class="box-wrap">
    <li class="box">1</li>
    <li class="box">2</li>
    <li class="box">3</li>
    <li class="box">4</li>
    <li class="box">5</li>
    <li class="box">6</li>
    <li class="box">7</li>
    <li class="box">8</li>
    <li class="box">9</li>
    <li class="box">10</li>
    <li class="box">11</li>
    <li class="box">12</li>
  </ul>
  <script>

    function DraggableManager() {
      function Draggable(elem, cbDragStart, cbDragEnd) {
        this.elem = elem;
        this.cbDragStart = cbDragStart;
        this.cbDragEnd = cbDragEnd;
        this.dragging = false;
        this.lastMousePos = { x: 0, y: 0 };
        this.dragKey = NaN;
        this.onDragStart = function (e) {
          if (!isNaN(this.dragKey) && e.button !== this.dragKey) {
            return;
          }
          if (this.dragging) {
            return;
          }

          this.dragKey = e.button;
          this.dragging = true;
          this.elem.dataset.dgDragging = this.dragging;
          this.lastMousePos.x = e.clientX;
          this.lastMousePos.y = e.clientY;
          this.cbDragStart && this.cbDragStart();
        };
        this.onDragMove = function (e) {
          if (!this.dragging) {
            return;
          }

          var posDiff = {
            x: e.clientX - this.lastMousePos.x,
            y: e.clientY - this.lastMousePos.y
          };
          this.lastMousePos.x = e.clientX;
          this.lastMousePos.y = e.clientY;
          var newPos = {
            x: this.elem.offsetLeft,
            y: this.elem.offsetTop
          };
          newPos.x += posDiff.x;
          newPos.y += posDiff.y;
          this.elem.style.top = newPos.y + "px";
          this.elem.style.left = newPos.x + "px";
        };
        this.onDragEnd = function (e) {
          if (!isNaN(this.dragKey) && e.button !== this.dragKey) {
            return;
          }
          if (!this.dragging) {
            return;
          }
          this.dragKey = NaN;
          this.dragging = false;
          this.elem.dataset.dgDragging = this.dragging;
          this.cbDragEnd && this.cbDragEnd();
        };

        listenEvent(elem, "mousedown", this.onDragStart.bind(this));
        listenEvent(elem, "mousemove", this.onDragMove.bind(this), { passive: true });
        listenEvent(elem, "mouseup", this.onDragEnd.bind(this));
        listenEvent(elem, "mouseout", this.onDragEnd.bind(this));
      }

      this.draggableList = [];
      this.addDraggable = function (...args) {
        this.draggableList.push(new Draggable(...args));
      };
    }

    var aBox = document.querySelectorAll(".box");
    var oBoxWrap = document.querySelector(".box-wrap");
    var dMgr = new DraggableManager();
    var boxToggleLifted = function (box) {
      return () => box.classList.toggle("box__lifted");
    };
    aBox.forEach((box) => dMgr.addDraggable(box, boxToggleLifted(box), boxToggleLifted(box)));
    oBoxWrap.style.height = oBoxWrap.offsetHeight + "px";
    oBoxWrap.style.width = oBoxWrap.offsetWidth + "px";
    aBox.forEach((box) => {
      box.style.top = box.offsetTop + "px";
      box.style.left = box.offsetLeft + "px";
    });
    aBox.forEach((box) => box.style.position = "absolute");
  </script>
</body>
</html>
